<?xml version="1.0" encoding="UTF-8"?>
<configuration>
  <include resource="org/springframework/boot/logging/logback/defaults.xml"/>
  <include resource="org/springframework/boot/logging/logback/console-appender.xml"/>

  <!--
    OpenTelemetry Appender (OTLP Collector로 로그 전송 → Loki)

    이 appender는 TracingConfiguration에서 OpenTelemetryAppender.install(openTelemetry)를 통해 초기화됩니다.
    기본값이 application-observability.yml에 설정되어 있으므로 환경변수 없이도 작동합니다.

    기본 OTLP 엔드포인트: http://grafana.dead-whale.org:30318

    선택적 환경변수 (기본값 오버라이드):
    - OTEL_EXPORTER_OTLP_ENDPOINT=http://grafana.dead-whale.org:30318
    - OTEL_EXPORTER_OTLP_LOGS_ENDPOINT=http://grafana.dead-whale.org:30318/v1/logs
    - OTEL_SERVICE_NAME=bottle-note
    - OTEL_LOGS_EXPORTER=otlp
    - OTEL_RESOURCE_ATTRIBUTES=service.name=bottle-note,service.version=1.0.0
  -->
  <appender name="OpenTelemetry"
            class="io.opentelemetry.instrumentation.logback.appender.v1_0.OpenTelemetryAppender"/>

  <root level="INFO">
    <appender-ref ref="CONSOLE"/>
    <appender-ref ref="OpenTelemetry"/>
  </root>

  <!-- 특정 라이브러리 로그 레벨 조정 -->
  <logger name="org.springframework.web" level="INFO"/>
  <logger name="org.hibernate" level="INFO"/>

  <!-- OpenTelemetry DEBUG 로깅 -->
  <logger name="io.opentelemetry" level="DEBUG"/>
  <logger name="io.opentelemetry.exporter" level="DEBUG"/>
  <logger name="io.opentelemetry.exporter.otlp" level="DEBUG"/>
  <logger name="io.opentelemetry.instrumentation.logback" level="DEBUG"/>
  <logger name="io.opentelemetry.sdk" level="DEBUG"/>

  <!-- B3 Propagator 불필요한 로그 억제 (B3 헤더가 없을 때 발생) -->
  <logger name="io.opentelemetry.extension.trace.propagation.B3" level="INFO"/>

</configuration>
