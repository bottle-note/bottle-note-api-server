# ë¸”ë¡ í•„í„°ë§ v1.0 - AOP ë°©ì‹

## ğŸ“‹ ê°œìš”

**AOP ê¸°ë°˜ ì»¨íŠ¸ë¡¤ëŸ¬ ë ˆë²¨ ë¸”ë¡ í•„í„°ë§**: `@BlockFilter` ì–´ë…¸í…Œì´ì…˜ì„ ì»¨íŠ¸ë¡¤ëŸ¬ ë©”ì„œë“œì— ì ìš©í•˜ì—¬ ì°¨ë‹¨ëœ ì‚¬ìš©ìì˜ ì»¨í…ì¸ ë¥¼ "ë¸”ëŸ¬" ì²˜ë¦¬í•˜ëŠ” ë°©ì‹

## ğŸ¯ @BlockFilter ì–´ë…¸í…Œì´ì…˜

```java
@Target(ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)
public @interface BlockFilter {
    /**
     * ì‘ë‹µ ê°ì²´ì—ì„œ ì‚¬ìš©ì IDë¥¼ ì¶”ì¶œí•  í•„ë“œëª…
     */
    String userField() default "authorId";
    
    /**
     * ë¸”ëŸ¬ ì²˜ë¦¬í•  í•„ë“œëª… ë°°ì—´
     */
    String[] blurFields() default {
        "content", "reviewContent", "title", 
        "authorNickname", "nickname", 
        "authorProfileImage", "profileImage"
    };
}
```

## ğŸ“ ì‚¬ìš© ì˜ˆì‹œ

### ì»¨íŠ¸ë¡¤ëŸ¬ ì ìš©
```java
@RestController
public class ReviewController {
    
    @BlockFilter(userField = "authorId")
    @GetMapping("/{alcoholId}")
    public ResponseEntity<?> getReviews(@PathVariable Long alcoholId) {
        // ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì‹¤í–‰
        return GlobalResponse.ok(reviewService.getReviews(alcoholId));
    }
}
```

## ğŸ”§ ë™ì‘ ì›ë¦¬

### 1. AOP Aspect ì²˜ë¦¬ íë¦„
```java
@Around("@annotation(blockFilter)")
public Object applyBlockFilter(ProceedingJoinPoint joinPoint, BlockFilter blockFilter) {
    // 1. ì›ë³¸ ë©”ì„œë“œ ì‹¤í–‰
    Object result = joinPoint.proceed();
    
    // 2. í˜„ì¬ ì‚¬ìš©ì ID ì¶”ì¶œ
    Long currentUserId = extractCurrentUserId();
    
    // 3. ì°¨ë‹¨ëœ ì‚¬ìš©ì ëª©ë¡ ì¡°íšŒ
    Set<Long> blockedUserIds = blockService.getBlockedUserIds(currentUserId);
    
    // 4. ì‘ë‹µ ë°ì´í„°ì— ë¸”ëŸ¬ ì²˜ë¦¬ ì ìš©
    return applyBlurFilter(result, blockedUserIds, blockFilter);
}
```

### 2. ë¸”ëŸ¬ ì²˜ë¦¬ ê³¼ì •
1. **ResponseEntity â†’ GlobalResponse â†’ data ìˆœìœ¼ë¡œ íƒìƒ‰**
2. **ë°ì´í„° íƒ€ì… í™•ì¸**: List ë˜ëŠ” ë‹¨ì¼ ê°ì²´
3. **ê° í•­ëª©ë³„ë¡œ ì‚¬ìš©ì ID ì¶”ì¶œ** (`userField` ì‚¬ìš©)
4. **ì°¨ë‹¨ ëŒ€ìƒì¸ì§€ í™•ì¸** (blockedUserIdsì— í¬í•¨ ì—¬ë¶€)
5. **ì°¨ë‹¨ëœ ê²½ìš° ê°ì²´ ë³µì œ í›„ í•„ë“œ ë§ˆìŠ¤í‚¹**

### 3. í•„ë“œ ë§ˆìŠ¤í‚¹ ê·œì¹™
```java
// í…ìŠ¤íŠ¸ í•„ë“œ: "ì°¨ë‹¨ëœ ì‚¬ìš©ìì˜ ê¸€ì…ë‹ˆë‹¤"
reviewContent â†’ "ì°¨ë‹¨ëœ ì‚¬ìš©ìì˜ ê¸€ì…ë‹ˆë‹¤"
authorNickname â†’ "ì°¨ë‹¨ëœ ì‚¬ìš©ìì˜ ê¸€ì…ë‹ˆë‹¤"

// ì´ë¯¸ì§€/URL í•„ë“œ: null ì²˜ë¦¬
authorProfileImage â†’ null
imageUrl â†’ null
```

## ğŸ¨ ì²˜ë¦¬ ê²°ê³¼

### ì •ìƒ ì‚¬ìš©ì ì‘ë‹µ
```json
{
  "success": true,
  "data": {
    "reviewList": [
      {
        "authorId": 123,
        "reviewContent": "ì •ë§ ë§›ìˆëŠ” ìœ„ìŠ¤í‚¤ì…ë‹ˆë‹¤!",
        "authorNickname": "ìœ„ìŠ¤í‚¤ëŸ¬ë²„",
        "authorProfileImage": "profile.jpg"
      }
    ]
  }
}
```

### ì°¨ë‹¨ëœ ì‚¬ìš©ì ì‘ë‹µ (ë¸”ëŸ¬ ì²˜ë¦¬ í›„)
```json
{
  "success": true,
  "data": {
    "reviewList": [
      {
        "authorId": 456,
        "reviewContent": "ì°¨ë‹¨ëœ ì‚¬ìš©ìì˜ ê¸€ì…ë‹ˆë‹¤",
        "authorNickname": "ì°¨ë‹¨ëœ ì‚¬ìš©ìì˜ ê¸€ì…ë‹ˆë‹¤", 
        "authorProfileImage": null
      }
    ]
  }
}
```

## ğŸ› ï¸ êµ¬í˜„ êµ¬ì¡°

### í•µì‹¬ íŒŒì¼ë“¤
- `annotation/BlockFilter.java` - ì–´ë…¸í…Œì´ì…˜ ì •ì˜
- `aspect/BlockFilterAspect.java` - AOP ì²˜ë¦¬ ë¡œì§
- `service/BlockService.java` - ì°¨ë‹¨ ê´€ê³„ ì¡°íšŒ
- `controller/BlockTestController.java` - í…ŒìŠ¤íŠ¸ ì»¨íŠ¸ë¡¤ëŸ¬

### ì£¼ìš” ë©”ì„œë“œ
1. **extractCurrentUserId()**: í˜„ì¬ ì‚¬ìš©ì ID ì¶”ì¶œ (í…ŒìŠ¤íŠ¸ìš© ê³ ì •ê°’)
2. **applyBlurFilter()**: ì‘ë‹µ ë°ì´í„° íƒ€ì…ë³„ ë¸”ëŸ¬ ì²˜ë¦¬ ë¶„ê¸°
3. **blurItemIfBlocked()**: ê°œë³„ í•­ëª© ì°¨ë‹¨ ì—¬ë¶€ í™•ì¸ ë° ì²˜ë¦¬
4. **applyBlurToItem()**: Jackson ê¹Šì€ ë³µì‚¬ í›„ í•„ë“œ ë§ˆìŠ¤í‚¹
5. **maskField()**: í•„ë“œ íƒ€ì…ì— ë”°ë¥¸ ë§ˆìŠ¤í‚¹ ê°’ ì„¤ì •

## ğŸš§ í•œê³„ì 

### 1. ë³µì¡í•œ ì²˜ë¦¬ ê³¼ì •
- **ResponseEntity â†’ GlobalResponse â†’ data êµ¬ì¡° ì˜ì¡´ì„±**
- **ë¦¬í”Œë ‰ì…˜ ê¸°ë°˜ í•„ë“œ ì ‘ê·¼ìœ¼ë¡œ ì¸í•œ ì„±ëŠ¥ ì´ìŠˆ**
- **Jackson ê¹Šì€ ë³µì‚¬ë¡œ ì¸í•œ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ì¦ê°€**

### 2. ì»¨íŠ¸ë¡¤ëŸ¬ ê²°í•©ë„
- **ê° ì»¨íŠ¸ë¡¤ëŸ¬ ë©”ì„œë“œë§ˆë‹¤ ì–´ë…¸í…Œì´ì…˜ ì¶”ê°€ í•„ìš”**
- **userField ì„¤ì •ì´ ì‘ë‹µ êµ¬ì¡°ì— ì˜ì¡´ì **
- **ìƒˆë¡œìš´ ì‘ë‹µ êµ¬ì¡° ì¶”ê°€ ì‹œ blurFields ì¬ì„¤ì • í•„ìš”**

### 3. ìœ ì§€ë³´ìˆ˜ ì–´ë ¤ì›€
- **AOP ì²˜ë¦¬ ê³¼ì •ì´ ë³µì¡í•˜ì—¬ ë””ë²„ê¹… ì–´ë ¤ì›€**
- **ì‘ë‹µ êµ¬ì¡° ë³€ê²½ ì‹œ í•„í„°ë§ ë¡œì§ë„ í•¨ê»˜ ìˆ˜ì • í•„ìš”**
- **í…ŒìŠ¤íŠ¸ìš© ê³ ì • ì‚¬ìš©ì ID ë“± ì„ì‹œ êµ¬í˜„ ì¡´ì¬**

### 4. í™•ì¥ì„± ì œí•œ
- **íŠ¹ì • ì‘ë‹µ êµ¬ì¡°(GlobalResponse)ì—ë§Œ ë™ì‘**
- **ì¤‘ì²© ê°ì²´ ë‚´ë¶€ í•„ë“œ ì²˜ë¦¬ ë³µì¡**
- **ë‹¤ì–‘í•œ ë¸”ëŸ¬ ì²˜ë¦¬ ë°©ì‹ ì ìš© ì–´ë ¤ì›€**

## ğŸ“ ê²°ë¡ 

AOP ë°©ì‹ì€ ì»¨íŠ¸ë¡¤ëŸ¬ ë ˆë²¨ì—ì„œ ë¸”ë¡ í•„í„°ë§ì„ ì²˜ë¦¬í•˜ì§€ë§Œ, ë³µì¡í•œ êµ¬ì¡°ì™€ ë†’ì€ ê²°í•©ë„ë¡œ ì¸í•´ ìœ ì§€ë³´ìˆ˜ê°€ ì–´ë ¤ìš´ ë°©ì‹ì…ë‹ˆë‹¤. íŠ¹íˆ ì‘ë‹µ êµ¬ì¡°ì— ëŒ€í•œ ì˜ì¡´ì„±ì´ ë†’ê³ , ì„±ëŠ¥ìƒ ì˜¤ë²„í—¤ë“œê°€ ì¡´ì¬í•©ë‹ˆë‹¤.