# Block API 테스트 가이드

이 디렉토리는 `BlockTestController`의 차단 기능을 테스트하기 위한 HTTP 파일들을 포함합니다.

## 🔧 사전 준비

1. **환경 설정**: 이 컨트롤러는 `local`, `dev`, `test` 환경에서만 동작합니다 (`prod` 환경에서는 비활성화)
2. **환경 변수**: IntelliJ HTTP Client에서 `http-client.env.json` 파일의 환경을 선택해야 합니다
   - `local`: http://localhost:30001
   - `dev`: http://localhost:30001  
   - `prod`: https://api.bottle-note.com/
3. **인증**: Block API (`/api/v1/test/**`)는 인증이 필요하지 않습니다 (Spring Security에서 `permitAll()` 설정)
4. **토큰 (선택사항)**: 필요시 01번 파일의 토큰 발급 API를 사용하여 `accessToken` 변수를 설정할 수 있습니다

## 📁 테스트 파일 구성

### 01-차단_관계_생성.http
- **목적**: 차단 관계를 생성하는 API 테스트
- **엔드포인트**: `POST /api/v1/test/block/add`
- **파라미터**:
  - `blockerId`: 차단하는 사용자 ID (필수)
  - `blockedId`: 차단당하는 사용자 ID (필수)  
  - `reason`: 차단 사유 (선택, 기본값: "테스트 차단")

### 02-차단_여부_확인.http
- **목적**: 두 사용자 간 차단 여부를 확인하는 API 테스트
- **엔드포인트**: `GET /api/v1/test/block/check`
- **파라미터**:
  - `blockerId`: 차단하는 사용자 ID
  - `blockedId`: 차단당하는 사용자 ID

### 03-차단_목록_조회.http
- **목적**: 특정 사용자가 차단한 사용자 목록을 조회하는 API 테스트
- **엔드포인트**: `GET /api/v1/test/block/list/{userId}`
- **경로 변수**: `userId` - 차단 목록을 조회할 사용자 ID

### 04-차단_통계_조회.http
- **목적**: 특정 사용자의 차단 통계를 조회하는 API 테스트
- **엔드포인트**: `GET /api/v1/test/block/statistics/{userId}`
- **경로 변수**: `userId` - 통계를 조회할 사용자 ID

### 05-차단_관계_해제.http
- **목적**: 차단 관계를 해제하는 API 테스트
- **엔드포인트**: `DELETE /api/v1/test/block/remove`
- **파라미터**:
  - `blockerId`: 차단을 해제할 사용자 ID
  - `blockedId`: 차단 해제 대상 사용자 ID

### 06-차단_필터_테스트.http
- **목적**: `@BlockFilter` 어노테이션이 적용된 API에서 차단된 사용자의 데이터가 필터링되는지 테스트
- **엔드포인트**: `GET /api/v1/test/block/test-data/{userId}`
- **경로 변수**: `userId` - 경로의 사용자 ID (실제로는 사용되지 않음)
- **헤더**: `X-User-Id` - 실제 요청하는 사용자 ID (테스트용 SecurityContext 설정)
- **특징**: 
  - 실제 리뷰 구조와 유사한 응답 데이터 제공
  - 차단한 사용자들의 데이터는 "차단된 사용자의 글입니다"로 마스킹됨
  - 차단된 사용자의 닉네임이 "차단된 사용자"로 변경됨
  - 프로필 이미지도 null로 처리됨

### 07-전체_초기화_테스트.http
- **목적**: 전체 차단 관계 초기화 API 테스트 (현재 비활성화됨)
- **엔드포인트**: `DELETE /api/v1/test/block/clear`
- **참고**: DB 기반으로 변경되어 안전상의 이유로 비활성화된 기능입니다

## 🚀 테스트 시나리오 예시

### 기본 시나리오
1. **차단 관계 생성**: 사용자 1이 사용자 2를 차단
2. **차단 여부 확인**: 1 → 2 차단 확인 (true), 2 → 1 차단 확인 (false)
3. **차단 목록 조회**: 사용자 1의 차단 목록에 사용자 2가 포함되는지 확인
4. **차단 필터 테스트**: 사용자 1로 요청 시 사용자 2의 데이터가 필터링되는지 확인
5. **차단 관계 해제**: 사용자 1이 사용자 2의 차단을 해제
6. **차단 여부 재확인**: 1 → 2 차단 확인 (false)

### 고급 시나리오
1. **상호 차단**: 사용자 1과 사용자 2가 서로 차단
2. **다중 차단**: 사용자 1이 여러 사용자(2, 3, 4)를 차단
3. **통계 확인**: 각 사용자별 차단 통계 조회
4. **필터링 확인**: 차단된 사용자들의 데이터가 모두 필터링되는지 확인

## ⚠️ 주의사항

1. **환경 제한**: `prod` 환경에서는 이 API들을 사용할 수 없습니다
2. **데이터 정합성**: 실제 운영 데이터와 연동되므로 테스트 시 주의가 필요합니다
3. **사용자 ID**: 존재하지 않는 사용자 ID로 테스트할 경우 예외가 발생할 수 있습니다
4. **전체 초기화**: 안전상의 이유로 비활성화되어 있으므로 개별 해제를 사용해야 합니다

## 🔍 응답 형태

모든 API는 `GlobalResponse` 형태로 응답합니다:

```json
{
  "success": true,
  "message": "성공 메시지",
  "data": "응답 데이터"
}
```

실패 시:
```json
{
  "success": false,
  "message": "실패 메시지",
  "data": null
}
```