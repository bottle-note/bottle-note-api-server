```
================================================================================
                          PROJECT COMPLETION STAMP
================================================================================
Status: **COMPLETED**
Completion Date: 2026-02-09

** Core Achievements **
- 배너 Admin CRUD API 7개 엔드포인트 구현 (목록/상세/생성/수정/삭제/상태변경/정렬순서변경)
- 비즈니스 규칙 검증 (날짜 선후관계, 외부 URL 연관, HEX 색상, 이름 중복, sortOrder 리오더링)
- 통합 테스트 16개 시나리오, RestDocs 문서화 7개 API, AsciiDoc 문서 + enum 참조 포함
- CI 4개 테스트 (unit, rule, integration, admin_integration) 전체 통과

** Key Components **
- AdminBannerService.java: mono 모듈, CRUD + 검증 + sortOrder 리오더링 로직
- AdminBannerController.kt: admin-api 모듈, 7개 엔드포인트 프레젠테이션 계층
- CustomBannerRepositoryImpl.java: QueryDSL 기반 Admin 검색 (키워드, isActive, bannerType 필터)
- BannerExceptionCode.java: 5개 배너 도메인 예외 코드

** Key Files (19개) **
- 수정 4개: Banner.java, BannerRepository.java, JpaBannerRepository.java, AdminResultResponse.java
- 신규 12개 (mono): DTO 7개, Service 1개, Exception 2개, Repository 2개
- 신규 4개 (admin-api): Controller 1개, 테스트 헬퍼 1개, 통합 테스트 1개, RestDocs 테스트 1개
- 문서 3개: banners.adoc, banner-type.adoc, text-position.adoc
================================================================================
```

# 어드민 배너 CRUD 기능 구현 계획

## 개요

어드민 API에 배너 관리(CRUD) 기능을 추가한다.
기존 큐레이션(Curation) Admin 패턴을 그대로 따르며, product-api의 배너 조회 전용 구조를 admin용으로 확장한다.

## 현재 상태

- **Banner 엔티티**: 구현 완료 (`Banner.java`, 16개 필드)
- **Product API**: 조회 전용 (`GET /api/v1/banners`) - `BannerQueryService`, `BannerQueryController`
- **BannerRepository**: `findById`, `findAllByIsActiveTrue` 2개 메서드만 존재 (조회 전용)
- **JpaBannerRepository**: `JpaRepository<Banner, Long>` + `BannerRepository` 상속, `@JpaRepositoryImpl`
- **BannerTestFactory**: 테스트용 엔티티 영속화 헬퍼 (mono 모듈, `@Component`)
- **Admin API**: 배너 관련 코드 없음
- **Banner 엔티티 update 메서드**: 없음 (현재 Builder만 존재)

## 비즈니스 규칙 및 검증 정책

### 필수 검증 (서비스 레벨)

| 규칙 | 설명 | 예외 코드 |
|------|------|-----------|
| 날짜 선후관계 | `startDate > endDate`이면 거부 | `BANNER_INVALID_DATE_RANGE` |
| 외부 URL + targetUrl 연관 | `isExternalUrl = true`일 때 `targetUrl`은 필수 (null/빈값 불가) | `BANNER_TARGET_URL_REQUIRED` |
| HEX 색상 형식 | `nameFontColor`, `descriptionFontColor`는 `#` + 6자리 HEX 패턴 (`^#[0-9a-fA-F]{6}$`) | `BANNER_INVALID_HEX_COLOR` |
| sortOrder 양수 | 생성/수정 시 `sortOrder`는 0 이상 (`@Min(0)`) | Bean Validation |
| 이름 중복 | `existsByName` 체크 (하드 삭제 기준, 삭제된 배너와의 중복은 고려하지 않음) | `BANNER_DUPLICATE_NAME` |

### 날짜 정책

| 케이스 | 처리 |
|--------|------|
| `startDate`만 있고 `endDate = null` | 허용 ("~부터 무기한 노출") |
| `endDate`만 있고 `startDate = null` | 허용 ("~까지만 노출") |
| 둘 다 `null` | 허용 (상시 노출, `isActive`로만 제어) |
| `endDate`가 이미 과거 | 저장은 허용하되 `isActive`를 `false`로 자동 조정 |
| `startDate > endDate` | 거부 (`BANNER_INVALID_DATE_RANGE`) |

### sortOrder 정책

| 케이스 | 처리 |
|--------|------|
| 새 배너의 `sortOrder`가 기존 배너와 중복 | 중복 불가: 해당 순서 이후의 기존 배너들을 +1씩 리오더링 |
| 예시: [1,2,3,4] 에 3 삽입 | 기존 3->4, 4->5 → 결과: [1,2,3(new),4,5] |
| 정렬 순서 변경(PATCH) 시에도 동일 | 대상 제외 후 나머지 리오더링 |

### URL 형식 검증

- `targetUrl`, `imageUrl`에 대한 URL 형식 검증은 수행하지 않음
- RestDocs 문서에 "[주의] URL 형식 검증을 수행하지 않으므로 클라이언트에서 유효한 URL을 전달해야 합니다" 명시

### 삭제 정책

- 하드 삭제 (DB에서 물리 삭제, 큐레이션 패턴과 동일)

## 엔드포인트 설계

context-path: `/admin/api/v1`

| HTTP | URL | 설명 | 요청 |
|------|-----|------|------|
| GET | `/banners` | 배너 목록 조회 (페이징, 필터) | `@ModelAttribute AdminBannerSearchRequest` |
| GET | `/banners/{bannerId}` | 배너 단건 상세 조회 | `@PathVariable` |
| POST | `/banners` | 배너 생성 | `@RequestBody @Valid AdminBannerCreateRequest` |
| PUT | `/banners/{bannerId}` | 배너 수정 | `@RequestBody @Valid AdminBannerUpdateRequest` |
| DELETE | `/banners/{bannerId}` | 배너 삭제 | `@PathVariable` |
| PATCH | `/banners/{bannerId}/status` | 활성화 상태 변경 | `@RequestBody AdminBannerStatusRequest` |
| PATCH | `/banners/{bannerId}/sort-order` | 정렬 순서 변경 | `@RequestBody AdminBannerSortOrderRequest` |

## 구현 파일 목록

### Phase 1: mono 모듈 - 도메인/리포지토리 확장

#### 1-1. Banner 엔티티 수정 메서드 추가
- **파일**: `bottlenote-mono/src/main/java/app/bottlenote/banner/domain/Banner.java`
- **작업**: `update()`, `updateStatus()`, `updateSortOrder()` 메서드 추가

```java
public void update(String name, String nameFontColor, String descriptionA, String descriptionB,
    String descriptionFontColor, String imageUrl, TextPosition textPosition,
    Boolean isExternalUrl, String targetUrl, BannerType bannerType,
    Integer sortOrder, LocalDateTime startDate, LocalDateTime endDate, Boolean isActive) {
    this.name = name;
    this.nameFontColor = nameFontColor;
    this.descriptionA = descriptionA;
    this.descriptionB = descriptionB;
    this.descriptionFontColor = descriptionFontColor;
    this.imageUrl = imageUrl;
    this.textPosition = textPosition;
    this.isExternalUrl = isExternalUrl;
    this.targetUrl = targetUrl;
    this.bannerType = bannerType;
    this.sortOrder = sortOrder;
    this.startDate = startDate;
    this.endDate = endDate;
    this.isActive = isActive;
}

public void updateStatus(Boolean isActive) {
    this.isActive = isActive;
}

public void updateSortOrder(Integer sortOrder) {
    this.sortOrder = sortOrder;
}
```

#### 1-2. BannerRepository에 Admin용 메서드 추가
- **파일**: `bottlenote-mono/src/main/java/app/bottlenote/banner/domain/BannerRepository.java`
- **작업**: `save`, `delete`, `existsByName`, `searchForAdmin`, `findAllBySortOrderGreaterThanEqual` 메서드 추가

```java
Banner save(Banner banner);
void delete(Banner banner);
boolean existsByName(String name);
List<Banner> findAllBySortOrderGreaterThanEqual(Integer sortOrder);
Page<AdminBannerListResponse> searchForAdmin(AdminBannerSearchRequest request, Pageable pageable);
```

#### 1-3. JpaBannerRepository에 메서드 추가
- **파일**: `bottlenote-mono/src/main/java/app/bottlenote/banner/repository/JpaBannerRepository.java`
- **작업**: `CustomBannerRepository` 상속 추가, `existsByName`, `findAllBySortOrderGreaterThanEqual` 추가
- `JpaRepository<Banner, Long>` 상속으로 `save`, `delete`는 자동 제공

```java
@JpaRepositoryImpl
public interface JpaBannerRepository extends BannerRepository, JpaRepository<Banner, Long>, CustomBannerRepository {
    List<Banner> findAllByIsActiveTrue();
    boolean existsByName(String name);
    List<Banner> findAllBySortOrderGreaterThanEqual(Integer sortOrder);
}
```

#### 1-4. CustomBannerRepository + Impl 생성 (QueryDSL)
- **신규 파일**: `bottlenote-mono/src/main/java/app/bottlenote/banner/repository/CustomBannerRepository.java`
- **신규 파일**: `bottlenote-mono/src/main/java/app/bottlenote/banner/repository/CustomBannerRepositoryImpl.java`
- **작업**: `searchForAdmin` QueryDSL 구현 (키워드 검색, isActive 필터, bannerType 필터, 페이징)

```java
// CustomBannerRepository.java
public interface CustomBannerRepository {
    Page<AdminBannerListResponse> searchForAdmin(AdminBannerSearchRequest request, Pageable pageable);
}

// CustomBannerRepositoryImpl.java - QueryDSL 구현
// 검색 조건: keyword(name LIKE), isActive, bannerType
// 정렬: sortOrder ASC, id DESC
// 페이징: offset 기반
```

### Phase 2: mono 모듈 - DTO

#### 2-1. 요청 DTO (record)
- **신규 파일**: `bottlenote-mono/src/main/java/app/bottlenote/banner/dto/request/AdminBannerSearchRequest.java`

```java
public record AdminBannerSearchRequest(
    String keyword,          // 배너명 검색
    Boolean isActive,        // 활성화 상태 필터 (null: 전체)
    BannerType bannerType,   // 배너 유형 필터 (null: 전체)
    Integer page,            // 기본값 0
    Integer size             // 기본값 20
) {
    public AdminBannerSearchRequest {
        page = page != null ? page : 0;
        size = size != null ? size : 20;
    }
}
```

- **신규 파일**: `bottlenote-mono/src/main/java/app/bottlenote/banner/dto/request/AdminBannerCreateRequest.java`

```java
public record AdminBannerCreateRequest(
    @NotBlank(message = "배너명은 필수입니다.") String name,
    @Pattern(regexp = "^#[0-9a-fA-F]{6}$", message = "HEX 색상 형식이 올바르지 않습니다.")
    String nameFontColor,
    @Size(max = 50, message = "배너 설명은 최대 50자까지 가능합니다.") String descriptionA,
    @Size(max = 50, message = "배너 설명은 최대 50자까지 가능합니다.") String descriptionB,
    @Pattern(regexp = "^#[0-9a-fA-F]{6}$", message = "HEX 색상 형식이 올바르지 않습니다.")
    String descriptionFontColor,
    @NotBlank(message = "이미지 URL은 필수입니다.") String imageUrl,
    TextPosition textPosition,
    Boolean isExternalUrl,
    String targetUrl,
    @NotNull(message = "배너 유형은 필수입니다.") BannerType bannerType,
    @Min(value = 0, message = "정렬 순서는 0 이상이어야 합니다.") Integer sortOrder,
    LocalDateTime startDate,
    LocalDateTime endDate
) {
    @Builder
    public AdminBannerCreateRequest {
        nameFontColor = nameFontColor != null ? nameFontColor : "#ffffff";
        descriptionFontColor = descriptionFontColor != null ? descriptionFontColor : "#ffffff";
        textPosition = textPosition != null ? textPosition : TextPosition.RT;
        isExternalUrl = isExternalUrl != null ? isExternalUrl : false;
        sortOrder = sortOrder != null ? sortOrder : 0;
    }
}
```

- **신규 파일**: `bottlenote-mono/src/main/java/app/bottlenote/banner/dto/request/AdminBannerUpdateRequest.java`

```java
public record AdminBannerUpdateRequest(
    @NotBlank(message = "배너명은 필수입니다.") String name,
    @Pattern(regexp = "^#[0-9a-fA-F]{6}$", message = "HEX 색상 형식이 올바르지 않습니다.")
    String nameFontColor,
    @Size(max = 50, message = "배너 설명은 최대 50자까지 가능합니다.") String descriptionA,
    @Size(max = 50, message = "배너 설명은 최대 50자까지 가능합니다.") String descriptionB,
    @Pattern(regexp = "^#[0-9a-fA-F]{6}$", message = "HEX 색상 형식이 올바르지 않습니다.")
    String descriptionFontColor,
    @NotBlank(message = "이미지 URL은 필수입니다.") String imageUrl,
    TextPosition textPosition,
    Boolean isExternalUrl,
    String targetUrl,
    @NotNull(message = "배너 유형은 필수입니다.") BannerType bannerType,
    @NotNull(message = "정렬 순서는 필수입니다.") @Min(value = 0, message = "정렬 순서는 0 이상이어야 합니다.") Integer sortOrder,
    LocalDateTime startDate,
    LocalDateTime endDate,
    @NotNull(message = "활성화 상태는 필수입니다.") Boolean isActive
) {}
```

- **신규 파일**: `bottlenote-mono/src/main/java/app/bottlenote/banner/dto/request/AdminBannerStatusRequest.java`

```java
public record AdminBannerStatusRequest(
    @NotNull(message = "활성화 상태는 필수입니다.") Boolean isActive
) {}
```

- **신규 파일**: `bottlenote-mono/src/main/java/app/bottlenote/banner/dto/request/AdminBannerSortOrderRequest.java`

```java
public record AdminBannerSortOrderRequest(
    @NotNull(message = "정렬 순서는 필수입니다.") @Min(value = 0, message = "정렬 순서는 0 이상이어야 합니다.") Integer sortOrder
) {}
```

#### 2-2. 응답 DTO (record)
- **신규 파일**: `bottlenote-mono/src/main/java/app/bottlenote/banner/dto/response/AdminBannerListResponse.java`

```java
public record AdminBannerListResponse(
    Long id,
    String name,
    BannerType bannerType,
    Integer sortOrder,
    Boolean isActive,
    LocalDateTime startDate,
    LocalDateTime endDate,
    LocalDateTime createdAt
) {}
```

- **신규 파일**: `bottlenote-mono/src/main/java/app/bottlenote/banner/dto/response/AdminBannerDetailResponse.java`

```java
public record AdminBannerDetailResponse(
    Long id,
    String name,
    String nameFontColor,
    String descriptionA,
    String descriptionB,
    String descriptionFontColor,
    String imageUrl,
    TextPosition textPosition,
    Boolean isExternalUrl,
    String targetUrl,
    BannerType bannerType,
    Integer sortOrder,
    LocalDateTime startDate,
    LocalDateTime endDate,
    Boolean isActive,
    LocalDateTime createdAt,
    LocalDateTime modifiedAt
) {
    public static AdminBannerDetailResponse of(Banner banner) {
        return new AdminBannerDetailResponse(
            banner.getId(),
            banner.getName(),
            banner.getNameFontColor(),
            banner.getDescriptionA(),
            banner.getDescriptionB(),
            banner.getDescriptionFontColor(),
            banner.getImageUrl(),
            banner.getTextPosition(),
            banner.getIsExternalUrl(),
            banner.getTargetUrl(),
            banner.getBannerType(),
            banner.getSortOrder(),
            banner.getStartDate(),
            banner.getEndDate(),
            banner.getIsActive(),
            banner.getCreateAt(),
            banner.getLastModifyAt()
        );
    }
}
```

### Phase 3: mono 모듈 - 서비스 + 예외

#### 3-1. AdminBannerService 생성
- **신규 파일**: `bottlenote-mono/src/main/java/app/bottlenote/banner/service/AdminBannerService.java`
- **참고 패턴**: `AdminCurationService.java` (동일 구조)

```java
@Slf4j
@Service
@RequiredArgsConstructor
public class AdminBannerService {

    private final BannerRepository bannerRepository;

    // 목록 조회 (페이징)
    @Transactional(readOnly = true)
    public GlobalResponse search(AdminBannerSearchRequest request) {
        PageRequest pageable = PageRequest.of(request.page(), request.size());
        return GlobalResponse.fromPage(bannerRepository.searchForAdmin(request, pageable));
    }

    // 단건 상세 조회
    @Transactional(readOnly = true)
    public AdminBannerDetailResponse getDetail(Long bannerId) {
        Banner banner = bannerRepository.findById(bannerId)
            .orElseThrow(() -> new BannerException(BANNER_NOT_FOUND));
        return AdminBannerDetailResponse.of(banner);
    }

    // 생성
    @Transactional
    public AdminResultResponse create(AdminBannerCreateRequest request) {
        // 이름 중복 체크
        if (bannerRepository.existsByName(request.name())) {
            throw new BannerException(BANNER_DUPLICATE_NAME);
        }

        // 날짜 검증: startDate > endDate
        validateDateRange(request.startDate(), request.endDate());

        // 외부 URL 연관 검증: isExternalUrl=true 시 targetUrl 필수
        validateExternalUrl(request.isExternalUrl(), request.targetUrl());

        // 만료 날짜 자동 비활성화: endDate가 과거이면 isActive=false
        boolean isActive = determineActiveStatus(true, request.endDate());

        // sortOrder 리오더링: 동일 순서 이후 배너들 +1
        reorderSortOrders(request.sortOrder(), null);

        Banner banner = Banner.builder()
            .name(request.name())
            .nameFontColor(request.nameFontColor())
            .descriptionA(request.descriptionA())
            .descriptionB(request.descriptionB())
            .descriptionFontColor(request.descriptionFontColor())
            .imageUrl(request.imageUrl())
            .textPosition(request.textPosition())
            .isExternalUrl(request.isExternalUrl())
            .targetUrl(request.targetUrl())
            .bannerType(request.bannerType())
            .sortOrder(request.sortOrder())
            .startDate(request.startDate())
            .endDate(request.endDate())
            .isActive(isActive)
            .build();

        Banner saved = bannerRepository.save(banner);
        return AdminResultResponse.of(BANNER_CREATED, saved.getId());
    }

    // 수정
    @Transactional
    public AdminResultResponse update(Long bannerId, AdminBannerUpdateRequest request) {
        Banner banner = bannerRepository.findById(bannerId)
            .orElseThrow(() -> new BannerException(BANNER_NOT_FOUND));

        validateDateRange(request.startDate(), request.endDate());
        validateExternalUrl(request.isExternalUrl(), request.targetUrl());

        boolean isActive = determineActiveStatus(request.isActive(), request.endDate());

        // sortOrder 변경 시 리오더링 (자신은 제외)
        if (!banner.getSortOrder().equals(request.sortOrder())) {
            reorderSortOrders(request.sortOrder(), banner.getId());
        }

        banner.update(
            request.name(), request.nameFontColor(),
            request.descriptionA(), request.descriptionB(), request.descriptionFontColor(),
            request.imageUrl(), request.textPosition(),
            request.isExternalUrl(), request.targetUrl(),
            request.bannerType(), request.sortOrder(),
            request.startDate(), request.endDate(), isActive
        );

        return AdminResultResponse.of(BANNER_UPDATED, bannerId);
    }

    // 삭제 (하드 삭제)
    @Transactional
    public AdminResultResponse delete(Long bannerId) {
        Banner banner = bannerRepository.findById(bannerId)
            .orElseThrow(() -> new BannerException(BANNER_NOT_FOUND));
        bannerRepository.delete(banner);
        return AdminResultResponse.of(BANNER_DELETED, bannerId);
    }

    // 활성화 상태 변경
    @Transactional
    public AdminResultResponse updateStatus(Long bannerId, AdminBannerStatusRequest request) {
        Banner banner = bannerRepository.findById(bannerId)
            .orElseThrow(() -> new BannerException(BANNER_NOT_FOUND));
        banner.updateStatus(request.isActive());
        return AdminResultResponse.of(BANNER_STATUS_UPDATED, bannerId);
    }

    // 정렬 순서 변경 (리오더링 포함)
    @Transactional
    public AdminResultResponse updateSortOrder(Long bannerId, AdminBannerSortOrderRequest request) {
        Banner banner = bannerRepository.findById(bannerId)
            .orElseThrow(() -> new BannerException(BANNER_NOT_FOUND));

        if (!banner.getSortOrder().equals(request.sortOrder())) {
            reorderSortOrders(request.sortOrder(), banner.getId());
        }

        banner.updateSortOrder(request.sortOrder());
        return AdminResultResponse.of(BANNER_SORT_ORDER_UPDATED, bannerId);
    }

    // -- private methods --

    private void validateDateRange(LocalDateTime startDate, LocalDateTime endDate) {
        if (startDate != null && endDate != null && startDate.isAfter(endDate)) {
            throw new BannerException(BANNER_INVALID_DATE_RANGE);
        }
    }

    private void validateExternalUrl(Boolean isExternalUrl, String targetUrl) {
        if (Boolean.TRUE.equals(isExternalUrl)
            && (targetUrl == null || targetUrl.isBlank())) {
            throw new BannerException(BANNER_TARGET_URL_REQUIRED);
        }
    }

    private boolean determineActiveStatus(boolean requestedIsActive, LocalDateTime endDate) {
        if (endDate != null && endDate.isBefore(LocalDateTime.now())) {
            return false;
        }
        return requestedIsActive;
    }

    private void reorderSortOrders(Integer newSortOrder, Long excludeBannerId) {
        List<Banner> conflicting = bannerRepository.findAllBySortOrderGreaterThanEqual(newSortOrder);
        conflicting.stream()
            .filter(b -> !b.getId().equals(excludeBannerId))
            .forEach(b -> b.updateSortOrder(b.getSortOrder() + 1));
    }
}
```

#### 3-2. BannerExceptionCode 생성
- **신규 파일**: `bottlenote-mono/src/main/java/app/bottlenote/banner/exception/BannerExceptionCode.java`
- **참고 패턴**: `AlcoholExceptionCode.java` (동일 구조: `ExceptionCode` 인터페이스 구현)

```java
public enum BannerExceptionCode implements ExceptionCode {
    BANNER_NOT_FOUND(HttpStatus.NOT_FOUND, "배너를 찾을 수 없습니다."),
    BANNER_DUPLICATE_NAME(HttpStatus.CONFLICT, "동일한 이름의 배너가 이미 존재합니다."),
    BANNER_INVALID_DATE_RANGE(HttpStatus.BAD_REQUEST, "시작일은 종료일보다 이전이어야 합니다."),
    BANNER_TARGET_URL_REQUIRED(HttpStatus.BAD_REQUEST, "외부 URL 사용 시 이동 URL은 필수입니다."),
    BANNER_INVALID_HEX_COLOR(HttpStatus.BAD_REQUEST, "HEX 색상 형식이 올바르지 않습니다.");

    private final HttpStatus httpStatus;
    private final String message;

    BannerExceptionCode(HttpStatus httpStatus, String message) {
        this.httpStatus = httpStatus;
        this.message = message;
    }

    @Override
    public String getMessage() { return message; }

    @Override
    public HttpStatus getHttpStatus() { return httpStatus; }
}
```

- **신규 파일**: `bottlenote-mono/src/main/java/app/bottlenote/banner/exception/BannerException.java`
- **참고 패턴**: `AlcoholException.java` (동일 구조: `AbstractCustomException` 상속)

```java
@Getter
public class BannerException extends AbstractCustomException {
    public BannerException(BannerExceptionCode code) {
        super(code);
    }
}
```

#### 3-3. AdminResultResponse.ResultCode에 배너 코드 추가
- **파일**: `bottlenote-mono/src/main/java/app/bottlenote/global/dto/response/AdminResultResponse.java`
- **작업**: ResultCode enum에 추가

```java
BANNER_CREATED("배너가 등록되었습니다."),
BANNER_UPDATED("배너가 수정되었습니다."),
BANNER_DELETED("배너가 삭제되었습니다."),
BANNER_STATUS_UPDATED("배너 활성화 상태가 변경되었습니다."),
BANNER_SORT_ORDER_UPDATED("배너 정렬 순서가 변경되었습니다."),
```

### Phase 4: admin-api 모듈 - 컨트롤러

#### 4-1. AdminBannerController 생성
- **신규 파일**: `bottlenote-admin-api/src/main/kotlin/app/bottlenote/banner/presentation/AdminBannerController.kt`
- **참고 패턴**: `AdminCurationController.kt` (동일 구조)

```kotlin
@RestController
@RequestMapping("/banners")
class AdminBannerController(
    private val adminBannerService: AdminBannerService
) {
    @GetMapping
    fun list(@ModelAttribute request: AdminBannerSearchRequest): ResponseEntity<GlobalResponse> {
        return ResponseEntity.ok(adminBannerService.search(request))
    }

    @GetMapping("/{bannerId}")
    fun detail(@PathVariable bannerId: Long): ResponseEntity<*> {
        return GlobalResponse.ok(adminBannerService.getDetail(bannerId))
    }

    @PostMapping
    fun create(@RequestBody @Valid request: AdminBannerCreateRequest): ResponseEntity<*> {
        return GlobalResponse.ok(adminBannerService.create(request))
    }

    @PutMapping("/{bannerId}")
    fun update(
        @PathVariable bannerId: Long,
        @RequestBody @Valid request: AdminBannerUpdateRequest
    ): ResponseEntity<*> {
        return GlobalResponse.ok(adminBannerService.update(bannerId, request))
    }

    @DeleteMapping("/{bannerId}")
    fun delete(@PathVariable bannerId: Long): ResponseEntity<*> {
        return GlobalResponse.ok(adminBannerService.delete(bannerId))
    }

    @PatchMapping("/{bannerId}/status")
    fun updateStatus(
        @PathVariable bannerId: Long,
        @RequestBody @Valid request: AdminBannerStatusRequest
    ): ResponseEntity<*> {
        return GlobalResponse.ok(adminBannerService.updateStatus(bannerId, request))
    }

    @PatchMapping("/{bannerId}/sort-order")
    fun updateSortOrder(
        @PathVariable bannerId: Long,
        @RequestBody @Valid request: AdminBannerSortOrderRequest
    ): ResponseEntity<*> {
        return GlobalResponse.ok(adminBannerService.updateSortOrder(bannerId, request))
    }
}
```

### Phase 5: 테스트

#### 5-1. 테스트 헬퍼
- **신규 파일**: `bottlenote-admin-api/src/test/kotlin/app/helper/banner/BannerHelper.kt`
- **참고 패턴**: `CurationHelper.kt` (`object` 싱글톤, `Map<String, Any?>` 반환)

```kotlin
object BannerHelper {

    fun createAdminBannerListResponse(
        id: Long = 1L,
        name: String = "테스트 배너",
        bannerType: BannerType = BannerType.CURATION,
        sortOrder: Int = 0,
        isActive: Boolean = true,
        startDate: LocalDateTime? = null,
        endDate: LocalDateTime? = null,
        createdAt: LocalDateTime = LocalDateTime.of(2024, 1, 1, 0, 0)
    ): AdminBannerListResponse = AdminBannerListResponse(
        id, name, bannerType, sortOrder, isActive, startDate, endDate, createdAt
    )

    fun createAdminBannerListResponses(count: Int = 3): List<AdminBannerListResponse> =
        (1..count).map { i ->
            createAdminBannerListResponse(
                id = i.toLong(),
                name = "배너 $i",
                sortOrder = i - 1,
                createdAt = LocalDateTime.of(2024, i, 1, 0, 0)
            )
        }

    fun createAdminBannerDetailResponse(
        id: Long = 1L,
        name: String = "테스트 배너",
        nameFontColor: String = "#ffffff",
        descriptionA: String? = "배너 설명A",
        descriptionB: String? = "배너 설명B",
        descriptionFontColor: String = "#ffffff",
        imageUrl: String = "https://example.com/banner.jpg",
        textPosition: TextPosition = TextPosition.RT,
        isExternalUrl: Boolean = false,
        targetUrl: String? = null,
        bannerType: BannerType = BannerType.CURATION,
        sortOrder: Int = 0,
        startDate: LocalDateTime? = null,
        endDate: LocalDateTime? = null,
        isActive: Boolean = true,
        createdAt: LocalDateTime = LocalDateTime.of(2024, 1, 1, 0, 0),
        modifiedAt: LocalDateTime = LocalDateTime.of(2024, 6, 1, 0, 0)
    ): AdminBannerDetailResponse = AdminBannerDetailResponse(
        id, name, nameFontColor, descriptionA, descriptionB, descriptionFontColor,
        imageUrl, textPosition, isExternalUrl, targetUrl, bannerType, sortOrder,
        startDate, endDate, isActive, createdAt, modifiedAt
    )

    fun createBannerCreateRequest(
        name: String = "새 배너",
        nameFontColor: String = "#ffffff",
        descriptionA: String? = "배너 설명A",
        descriptionB: String? = "배너 설명B",
        descriptionFontColor: String = "#ffffff",
        imageUrl: String = "https://example.com/banner.jpg",
        textPosition: String = "RT",
        isExternalUrl: Boolean = false,
        targetUrl: String? = null,
        bannerType: String = "CURATION",
        sortOrder: Int = 0,
        startDate: String? = null,
        endDate: String? = null
    ): Map<String, Any?> = mapOf(
        "name" to name,
        "nameFontColor" to nameFontColor,
        "descriptionA" to descriptionA,
        "descriptionB" to descriptionB,
        "descriptionFontColor" to descriptionFontColor,
        "imageUrl" to imageUrl,
        "textPosition" to textPosition,
        "isExternalUrl" to isExternalUrl,
        "targetUrl" to targetUrl,
        "bannerType" to bannerType,
        "sortOrder" to sortOrder,
        "startDate" to startDate,
        "endDate" to endDate
    )

    fun createBannerUpdateRequest(
        name: String = "수정된 배너",
        nameFontColor: String = "#000000",
        descriptionA: String? = "수정된 설명A",
        descriptionB: String? = "수정된 설명B",
        descriptionFontColor: String = "#000000",
        imageUrl: String = "https://example.com/updated.jpg",
        textPosition: String = "CENTER",
        isExternalUrl: Boolean = false,
        targetUrl: String? = null,
        bannerType: String = "CURATION",
        sortOrder: Int = 1,
        startDate: String? = null,
        endDate: String? = null,
        isActive: Boolean = true
    ): Map<String, Any?> = mapOf(
        "name" to name,
        "nameFontColor" to nameFontColor,
        "descriptionA" to descriptionA,
        "descriptionB" to descriptionB,
        "descriptionFontColor" to descriptionFontColor,
        "imageUrl" to imageUrl,
        "textPosition" to textPosition,
        "isExternalUrl" to isExternalUrl,
        "targetUrl" to targetUrl,
        "bannerType" to bannerType,
        "sortOrder" to sortOrder,
        "startDate" to startDate,
        "endDate" to endDate,
        "isActive" to isActive
    )

    fun createBannerStatusRequest(isActive: Boolean = true): Map<String, Any> =
        mapOf("isActive" to isActive)

    fun createBannerSortOrderRequest(sortOrder: Int = 1): Map<String, Any> =
        mapOf("sortOrder" to sortOrder)

    fun createAdminResultResponse(
        code: AdminResultResponse.ResultCode = AdminResultResponse.ResultCode.BANNER_CREATED,
        targetId: Long = 1L
    ): AdminResultResponse = AdminResultResponse.of(code, targetId)
}
```

#### 5-2. 통합 테스트
- **신규 파일**: `bottlenote-admin-api/src/test/kotlin/app/integration/banner/AdminBannerIntegrationTest.kt`
- **참고 패턴**: `AdminCurationIntegrationTest.kt`
- **태그**: `@Tag("admin_integration")`
- **베이스**: `IntegrationTestSupport` 상속
- **시나리오**:

```
목록 조회:
  - 기본 목록 조회
  - 키워드 필터링
  - 활성화 상태 필터링
  - 배너 유형 필터링
  - 인증 없이 요청 시 401

상세 조회:
  - 성공
  - 존재하지 않는 배너 404

생성:
  - 성공
  - 이름 중복 409
  - 필수값 누락 400
  - startDate > endDate 400
  - isExternalUrl=true + targetUrl 누락 400
  - 잘못된 HEX 색상 400
  - endDate가 과거일 때 isActive 자동 false
  - sortOrder 중복 시 리오더링 검증

수정:
  - 성공
  - 존재하지 않는 배너 404
  - 날짜/URL/HEX 검증 동일 적용

삭제:
  - 성공
  - 존재하지 않는 배너 404

상태 변경:
  - 성공
  - 존재하지 않는 배너 404

정렬 순서 변경:
  - 성공
  - 리오더링 검증

인증:
  - 인증 없이 요청 시 실패
```

#### 5-3. RestDocs 테스트
- **신규 파일**: `bottlenote-admin-api/src/test/kotlin/app/docs/banner/AdminBannerControllerDocsTest.kt`
- **참고 패턴**: `AdminCurationControllerDocsTest.kt`
- **설정**: `@WebMvcTest`, `@AutoConfigureRestDocs`, `@MockitoBean`
- **문서화**: 각 API별 요청/응답 필드 문서화
- **특이사항**: `targetUrl`, `imageUrl` 필드 description에 "[주의] URL 형식 검증을 수행하지 않으므로 클라이언트에서 유효한 URL을 전달해야 합니다" 명시

## 파일 변경 요약

### 수정 파일 (4개)
| 파일 | 작업 |
|------|------|
| `Banner.java` | update, updateStatus, updateSortOrder 메서드 추가 |
| `BannerRepository.java` | save, delete, existsByName, findAllBySortOrderGreaterThanEqual, searchForAdmin 메서드 추가 |
| `JpaBannerRepository.java` | CustomBannerRepository 상속 추가, existsByName, findAllBySortOrderGreaterThanEqual 추가 |
| `AdminResultResponse.java` | ResultCode에 BANNER_* 5개 코드 추가 |

### 신규 파일 (15개)

**mono 모듈 (12개)**:
| 파일 | 위치 |
|------|------|
| `CustomBannerRepository.java` | banner/repository/ |
| `CustomBannerRepositoryImpl.java` | banner/repository/ |
| `AdminBannerSearchRequest.java` | banner/dto/request/ |
| `AdminBannerCreateRequest.java` | banner/dto/request/ |
| `AdminBannerUpdateRequest.java` | banner/dto/request/ |
| `AdminBannerStatusRequest.java` | banner/dto/request/ |
| `AdminBannerSortOrderRequest.java` | banner/dto/request/ |
| `AdminBannerListResponse.java` | banner/dto/response/ |
| `AdminBannerDetailResponse.java` | banner/dto/response/ |
| `AdminBannerService.java` | banner/service/ |
| `BannerExceptionCode.java` | banner/exception/ |
| `BannerException.java` | banner/exception/ |

**admin-api 모듈 (3개)**:
| 파일 | 위치 |
|------|------|
| `AdminBannerController.kt` | banner/presentation/ |
| `AdminBannerIntegrationTest.kt` | integration/banner/ |
| `AdminBannerControllerDocsTest.kt` | docs/banner/ |

**admin-api 테스트 헬퍼 (1개)**:
| 파일 | 위치 |
|------|------|
| `BannerHelper.kt` | helper/banner/ |

## 구현 순서

```
Phase 1 (도메인/리포지토리) -> Phase 2 (DTO) -> Phase 3 (서비스/예외) -> Phase 4 (컨트롤러) -> Phase 5 (테스트)
```

각 Phase 완료 후 컴파일 확인:
- Phase 1-3: `./gradlew :bottlenote-mono:compileJava`
- Phase 4: `./gradlew :bottlenote-admin-api:compileKotlin`
- Phase 5: `./gradlew :bottlenote-admin-api:admin_integration_test`

## 참고 패턴

### 기존 어드민 구현체 참조
| 구현체 | 위치 | 참고 포인트 |
|--------|------|------------|
| `AdminCurationController.kt` | admin-api | 컨트롤러 구조, 응답 래핑 방식 |
| `AdminCurationService.java` | mono | 서비스 CRUD 패턴, 예외 처리, 트랜잭션 |
| `AdminCurationCreateRequest.java` | mono | record compact constructor 기본값 설정 |
| `AdminCurationDisplayOrderRequest.java` | mono | `@NotNull` + `@Min(0)` 검증 패턴 |
| `AlcoholExceptionCode.java` | mono | `ExceptionCode` 인터페이스 구현 패턴 |
| `AlcoholException.java` | mono | `AbstractCustomException` 상속 패턴 |
| `CurationHelper.kt` | admin-api test | `object` 싱글톤 헬퍼, `Map<String, Any?>` 반환 |
| `AdminCurationIntegrationTest.kt` | admin-api test | 통합 테스트 구조, `@Nested`, `mockMvcTester` |
| `AdminCurationControllerDocsTest.kt` | admin-api test | RestDocs 문서화 패턴 |
| `BannerTestFactory.java` | mono test | 테스트 데이터 영속화 헬퍼 (`@Component`) |

### 예외 계층 구조
```
RuntimeException
  -> AbstractCustomException (ExceptionCode 보유)
    -> AlcoholException (AlcoholExceptionCode)
    -> BannerException (BannerExceptionCode)  <-- 신규
```

### 응답 패턴
- 목록 조회: `ResponseEntity.ok(adminBannerService.search(request))` -> `GlobalResponse.fromPage()`
- 단건 조회: `GlobalResponse.ok(response)`
- CUD 작업: `GlobalResponse.ok(AdminResultResponse.of(ResultCode, targetId))`
