# 테스트 커버리지 개선 계획 - 개요

## 문서의 목적

이 문서는 bottle-note-api-server 프로젝트의 테스트 커버리지를 체계적으로 개선하기 위한 전체 계획을 제시합니다.

## 왜 테스트 커버리지 개선이 필요한가

### 현재 상황

프로젝트는 우수한 테스트 인프라를 보유하고 있습니다:
- TestContainers를 활용한 실제 환경 테스트
- InMemory 구현체를 통한 빠른 단위 테스트
- Fixture 패턴을 통한 체계적인 테스트 데이터 관리
- Given-When-Then 패턴의 일관된 사용

그러나 핵심 계층에서 테스트 공백이 존재합니다:
- **Facade 계층: 0%** - 도메인 간 조합 로직 검증 부재
- **보안/인증: 0%** - JWT, OAuth 등 보안 핵심 로직 검증 부재
- **핵심 Service: 약 50%** - 중요 비즈니스 로직 일부만 커버

### 테스트 커버리지의 의미

테스트 커버리지는 단순한 코드 실행 비율이 아닙니다. 이는 다음을 의미합니다:

**기능의 신뢰성 보장**
- 작성한 코드가 의도대로 동작함을 증명
- 예외 상황, 엣지 케이스 처리 검증

**리팩토링의 안전망**
- 코드 구조 변경 시 기능 보존 확인
- 회귀 버그 조기 발견

**팀 협업의 기반**
- 실행 가능한 문서로서의 역할
- 비즈니스 요구사항의 명세화

**유지보수 비용 절감**
- 프로덕션 버그 감소
- 디버깅 시간 단축

## 개선 대상 영역

이 계획은 3가지 핵심 영역에 집중합니다:

### 1. Facade 계층 테스트
**중요도: 최우선**

Facade는 여러 Service를 조합하여 도메인 간 계약을 구현하는 핵심 계층입니다.
- 현재 상태: 4개 Facade 중 0개 테스트됨 (0%)
- 목표: 주요 Facade 100% 커버
- 이유: 도메인 간 통신의 정확성 보장

### 2. 보안/인증 테스트
**중요도: 최우선**

시스템의 보안은 한 번 뚫리면 복구가 어렵습니다.
- 현재 상태: JWT, OAuth, Security 관련 테스트 0%
- 목표: 핵심 보안 로직 100% 커버
- 이유: 보안 취약점 사전 방지

### 3. 핵심 Service 테스트
**중요도: 높음**

비즈니스 로직의 심장인 Service 계층 강화.
- 현재 상태: 약 50% 커버 (일부 핵심 Service 누락)
- 목표: 핵심 Service 90% 이상 커버
- 이유: 비즈니스 요구사항 보장

## 목표 커버리지 수치

### 전체 목표

| 계층 | 현재 | 목표 | 우선순위 |
|-----|------|------|---------|
| Facade | 0% | 100% | P0 |
| 보안/인증 | 0% | 100% | P0 |
| 핵심 Service | 50% | 90% | P1 |
| CustomRepository | 22% (2/9) | 80% (7/9) | P1 |
| Controller | 80% | 유지 | P2 |

### 구체적 목표

**Facade 계층: 100%**
- DefaultUserFacade: 0% → 100%
- DefaultReviewFacade: 0% → 100%
- DefaultAlcoholFacade: 0% → 100%
- FollowService: 0% → 100%

**보안/인증: 100%**
- JwtTokenProvider: 0% → 100%
- JwtTokenValidator: 0% → 100%
- AppleTokenValidator: 0% → 100%
- KakaoAuthService: 0% → 100%
- AppleAuthService: 0% → 100%

**핵심 Service: 90%**
- ReviewService: 0% → 100%
- AlcoholViewHistoryService: 0% → 100%
- RatingQueryService: 0% → 90%
- AlcoholPopularService: 0% → 90%

## 커버리지 측정 기준

### Line Coverage (라인 커버리지)
전체 코드 라인 중 테스트가 실행한 라인의 비율

### Branch Coverage (분기 커버리지)
모든 if/else 분기, Optional, 예외 경로의 테스트 여부

### 실용적 기준
숫자보다 중요한 것은 "핵심 시나리오 커버"입니다:
- 정상 케이스
- 예외 케이스
- 엣지 케이스
- 권한/검증 케이스

## 실행 계획

### Phase 1: 최우선 (P0) - 2주
1. Facade 테스트 작성
   - DefaultReviewFacade
   - DefaultUserFacade
2. 보안/인증 테스트 작성
   - JwtTokenProvider
   - JwtTokenValidator

### Phase 2: 중요 (P1) - 3주
3. 핵심 Service 테스트 작성
   - ReviewService
   - AlcoholViewHistoryService
4. CustomRepository 테스트 확대

### Phase 3: 보통 (P2) - 진행 중
5. 나머지 Service 테스트
6. 통합 테스트 확대

## 기대 효과

### 단기 효과
- 숨어있던 버그 조기 발견
- 리팩토링 시 자신감 확보
- 코드 리뷰 품질 향상

### 장기 효과
- 프로덕션 버그 감소
- 유지보수 비용 절감
- 신규 개발자 온보딩 가속
- 기술 부채 감소

## 관련 문서

본 계획의 상세 내용은 다음 문서를 참조하세요:

- `1-퍼사드-커버리지.md`: Facade 계층 테스트 상세 계획
- `2-보안인증-테스트-추가.md`: 보안/인증 테스트 상세 계획
- `3-핵심-Service-테스트-추가.md`: 핵심 Service 테스트 상세 계획

## 진행 상황 추적

각 문서의 체크리스트를 통해 진행 상황을 추적합니다.
모든 체크리스트 완료 시 목표 커버리지 달성으로 간주합니다.
